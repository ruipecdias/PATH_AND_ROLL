<div>
  <div class='m-4'>
    <div class="d-flex justify-content-end">
      <%= cl_image_tag(@current_user.photo.key, class: 'rounded-circle', width: 50, height: 50, alt: 'User Photo') %>
    </div>

    <h2>Hi <%= current_user.first_name %></h2>
    <p style='color: #7b7f83;'>Check how's your area today</p>
  <div id='map' style='width: 100%; height: 25vh; border-radius: 5%;'
    data-controller="map"
    data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

  <div class='mt-3'>
  <div class='d-flex justify-content-between'>
  <h3>Incidents Affecting You</h3>
    <a href="<%= incidents_path %>" class="see-all">see all</a>
  </div>

    <%# Loop through incidents affecting the user %>

    <% if @affecting_incidents.present? %>
      <% @affecting_incidents.take(3).each do |incident| %>
        <div class='p-3 rounded-4 my-2 d-flex justify-content-between'
        style='background-color: #FFE9D6; color: #FF7900'>
        <div><%= incident.category %></div>
          <div>
            <%= incident.created_at.strftime('%d') %>
            <%= incident.created_at.strftime('%b') %>
            <%= incident.created_at.strftime('%Y') %>
          </div>
        </div>
    <% end %>
    <% else %>
      <p style='color: gray'><em>No incidents to display.<em></p>
    <% end %>

  <br>
  <h3>Your Reported Incidents</h3>

    <%# Loop through incidents reported by the user %>
    <% if @reported_incidents.present? %>
    <% @reported_incidents.take(3).each do |incident| %>
    <div class='p-3 rounded-4 my-2 d-flex justify-content-between'
    style='background-color: #FFE9D6; color: #FF7900'>
      <div><%= incident.description %></div>
      <div>
        <%= incident.created_at.strftime('%d') %>
        <%= incident.created_at.strftime('%b') %>
        <%= incident.created_at.strftime('%Y') %>
     </div>
    <% end %>
    <% else %>
     <p style='color: gray'><em>You haven't reported any incident yet.<em></p>
    <% end %>
  <div>
</div>
</div>
</div>
</div>
