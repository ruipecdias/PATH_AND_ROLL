<div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasBottom-<%= incident.id %>" aria-labelledby="offcanvasBottomLabel">
  <div class="offcanvas-header">
  </div>
  <div class="offcanvas-body small mx-3">
    <div class="d-flex justify-content-between">
      <div class="d-flex flex-column">
        <p><%= incident.affecting_pins.count %> <%= 'person'.pluralize(incident.affecting_pins.count) %> affected</p>
        <h2><%= incident.category %></h2>
        <p><i class="fa-solid fa-location-dot" style="color: #7b7f83;"></i> <%= incident.location %><p>
        <%= link_to incident_affecting_pins_path(incident), method: :post, remote: true, class: 'btn btn-link', id: 'toggleAffectButton' do %>
        <span id="toggleText">It affects me</span>
        <% end %>
      </div>
                <!-- Share Button with Options -->
      <div class="share-options">
        <button class="share-button" id="shareButton">
          <i class="fas fa-share-alt"></i>
        </button>

        <div class="options-container" id="optionsContainer">
          <!-- WhatsApp Share Button -->
          <%= link_to "https://api.whatsapp.com/send?text=#{incident_url(incident)}", target: '_blank', title: 'Share on WhatsApp' do %>
            <i class="fab fa-whatsapp"></i>
          <% end %>

          <!-- Copy Link Button -->
          <button id="copyLinkButton" title="Copy Link">
            <i class="far fa-copy"></i>
          </button>
        </div>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const shareButton = document.getElementById('shareButton');
          const optionsContainer = document.getElementById('optionsContainer');
          const copyLinkButton = document.getElementById('copyLinkButton');

          shareButton.addEventListener('click', function () {
            optionsContainer.classList.toggle('show-options');
          });

          copyLinkButton.addEventListener('click', function () {
            const incidentUrl = '<%= incident_url(incident) %>';
            const tempInput = document.createElement('input');
            document.body.appendChild(tempInput);
            tempInput.value = incidentUrl;
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert('Link copied to clipboard!');
          });
        });

        document.addEventListener('DOMContentLoaded', function () {
          const toggleAffectButton = document.getElementById('toggleAffectButton');
          const toggleText = document.getElementById('toggleText');

        toggleAffectButton.addEventListener('ajax:success', function (event) {
          const [data, status, xhr] = event.detail;

          // Toggle the button text and update the affecting_pins count
          const isAffected = data['is_affected'];
          const affectingPinsCount = data['affecting_pins_count'];

          toggleText.innerText = isAffected ? 'It doesn\'t affect me' : 'It affects me';

          // Update the affecting_pins count display (if needed)
          const affectingPinsCountDisplay = document.getElementById('affectingPinsCount');
          if (affectingPinsCountDisplay) {
            affectingPinsCountDisplay.innerText = affectingPinsCount;
          }
        });
      });
      </script>
    </div>
    <!-- need to improve line below -->
      <p>Is it still there?Y/N</p>
      <p><strong>Description:</strong> <%= incident.description %></p>
      <%= image_tag incident.img_url, alt: 'Incident Image' %>

      <%= link_to incident_comments_path(incident_id: incident.id) do %>
        <button type="button" class="btn btn-link">
          <%= incident.comments_count %> <%= 'comment'.pluralize(incident.comments_count) %>
        </button>
      <% end %>
  </div>
</div>
