<div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasBottom-<%= incident.id %>" aria-labelledby="offcanvasBottomLabel">
  <div class="offcanvas-header">
  </div>
  <div class="offcanvas-body small mx-3">
    <div class="d-flex justify-content-between">
      <div class="d-flex flex-column">
        <p><%= incident.affecting_pins.count %> <%= 'person'.pluralize(incident.affecting_pins.count) %> affected</p>
        <h2><%= incident.category %></h2>
        <p><i class="fa-solid fa-location-dot" style="color: #7b7f83;"></i> <%= incident.location %><p>

        <!-- IT AFFECTS ME BTN-->
        <button id="toggleButton" onclick="toggleText()" class="btn btn-primary text-white rounded-4 px-4 py-2">
          <i class="fa-solid fa-triangle-exclamation" style="color: #ffffff;"></i> It affects me</button>


          <%= link_to incident_comments_path(incident_id: incident.id) do %>
            <button type="button" class="btn btn-light rounded-4 px-4 py-2">
              <%= incident.comments_count %> <%= 'comment'.pluralize(incident.comments_count) %>
            </button>
          <% end %>
      </div>
                <!-- Share Button with Options -->
      <div class="share-options">
        <div class="share-button" id="shareButton">
          <i class="fa-solid fa-share-nodes" style="color: #7b7f83;"></i>
        </div>

        <div class="options-container" id="optionsContainer">
          <!-- WhatsApp Share Button -->
          <%= link_to "https://api.whatsapp.com/send?text=#{incident_url(incident)}", target: '_blank', title: 'Share on WhatsApp' do %>
            <i class="fab fa-whatsapp"></i>
          <% end %>

          <!-- Copy Link Button -->
          <button id="copyLinkButton" title="Copy Link">
            <i class="far fa-copy"></i>
          </button>
        </div>
      </div>

      <script>
        document.addEventListener('DOMContentLoaded', function () {
          const shareButton = document.getElementById('shareButton');
          const optionsContainer = document.getElementById('optionsContainer');
          const copyLinkButton = document.getElementById('copyLinkButton');

          shareButton.addEventListener('click', function () {
            optionsContainer.classList.toggle('show-options');
          });

          copyLinkButton.addEventListener('click', function () {
            const incidentUrl = '<%= incident_url(incident) %>';
            const tempInput = document.createElement('input');
            document.body.appendChild(tempInput);
            tempInput.value = incidentUrl;
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert('Link copied to clipboard!');
          });
        });

        /*The code below is for the it affects me btn*/
        let isBtnToggled = false;

        function toggleText() {
          const button = document.getElementById('toggleButton');

          if (isBtnToggled) {
            button.innerText = 'It affects me!';
          } else {
            button.innerText = 'It doens\'t affect me';
          }

          isBtnToggled = !isBtnToggled;
        }
      </script>
    </div>
    <!-- need to improve line below -->
      <p>Is it still there? Yes No</p>
      <p><strong>Description:</strong> <%= incident.description %></p>
      <%= image_tag incident.img_url, alt: 'Incident Image', class: 'w-100' %>

  </div>
</div>
